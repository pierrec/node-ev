#!/usr/bin/env node

function fn () { return this }
var obj = {}

Function.prototype.fakeBind = function (o) {
  var fn = this
    , args = Array.prototype.slice.call(arguments, 1)
  return function () { return fn.apply(o, args.concat(Array.prototype.slice.call(arguments))) }
}

var fakeBind = fn.fakeBind(obj)
var realBind = fn.bind(obj)

exports.compareCount = 20;
exports.time = 1000;
exports.compare =
  { "realBind" : realBind
  , "fakeBind" : fakeBind
  , "unbound" : fn
  }

require('bench').runMain()

// benchmarking /home/pierre/sandbox/git/node-ev/bench/bind.js
// Please be patient.
// { node: '0.6.12',
//   v8: '3.6.6.24',
//   ares: '1.7.5-DEV',
//   uv: '0.6',
//   openssl: '1.0.0e' }
// Scores: (bigger is better)

// unbound
// Raw:
//  > 148999.000999001
//  > 150544.45554445556
//  > 153028.97102897102
//  > 145201.7982017982
//  > 128963.03696303697
//  > 128935.06493506493
//  > 128900.0999000999
//  > 129166.83316683317
//  > 130839.16083916085
//  > 127555.44455544456
//  > 131139.86013986013
//  > 129728.27172827173
//  > 129649.35064935064
//  > 128601.3986013986
//  > 128862.13786213787
//  > 128348.65134865134
//  > 130991.00899100899
//  > 128267.73226773227
//  > 128782.21778221778
//  > 128910.08991008991
//  > 126235.76423576423
// Average (mean) 132935.73093573094

// fakeBind
// Raw:
//  > 6749.250749250749
//  > 6488.511488511488
//  > 6713.286713286713
//  > 6616.383616383617
//  > 6545.454545454545
//  > 6573.426573426574
//  > 6577.422577422577
//  > 6576.423576423576
//  > 6684.315684315684
//  > 6595.404595404595
//  > 6589.41058941059
//  > 6711.288711288711
//  > 6572.427572427572
//  > 6670.32967032967
//  > 6568.431568431569
//  > 6587.4125874125875
//  > 6676.323676323676
//  > 6593.406593406594
//  > 6527.472527472528
//  > 6505.494505494506
//  > 6625.374625374626
// Average (mean) 6607.012035583464

// realBind
// Raw:
//  > 5152.847152847153
//  > 5231.768231768232
//  > 5210.789210789211
//  > 5209.79020979021
//  > 5133.866133866134
//  > 5114.8851148851145
//  > 5135.864135864136
//  > 5145.854145854146
//  > 5124.875124875125
//  > 5252.747252747253
//  > 5200.799200799201
//  > 5228.771228771228
//  > 5151.848151848152
//  > 5181.818181818182
//  > 5140.859140859141
//  > 5106.893106893107
//  > 5235.764235764236
//  > 5130.8691308691305
//  > 5143.856143856144
//  > 5121.878121878122
//  > 5246.7532467532465
// Average (mean) 5171.590314447457

// Winner: unbound
// Compared with next highest (fakeBind), it's:
// 95.03% faster
// 20.12 times as fast
// 1.3 order(s) of magnitude faster

// Compared with the slowest (realBind), it's:
// 96.11% faster
// 25.71 times as fast
// 1.41 order(s) of magnitude faster


// benchmarking /home/pierre/sandbox/git/node-ev/bench/bind.js
// Please be patient.
// { node: '0.7.5',
//   v8: '3.9.5',
//   ares: '1.7.5-DEV',
//   uv: '0.6',
//   openssl: '0.9.8r' }
// Scores: (bigger is better)

// unbound
// Raw:
//  > 529552.4475524476
//  > 184084.9150849151
//  > 180805.1948051948
//  > 164500.4995004995
//  > 117736.26373626373
//  > 117555.44455544456
//  > 117866.13386613387
//  > 116057.94205794205
//  > 114938.06193806193
//  > 118330.66933066933
//  > 103498.5014985015
//  > 108460.53946053945
//  > 117545.45454545454
//  > 115578.42157842158
//  > 120522.47752247752
//  > 118352.64735264736
//  > 118412.58741258741
//  > 118478.52147852148
//  > 118329.67032967033
//  > 118252.74725274726
//  > 120194.8051948052
// Average (mean) 144716.85457399747

// realBind
// Raw:
//  > 8262.737262737262
//  > 8119.88011988012
//  > 8124.875124875125
//  > 7838.161838161838
//  > 7855.144855144855
//  > 7570.42957042957
//  > 7469.530469530469
//  > 7702.297702297702
//  > 7549.450549450549
//  > 7653.3466533466535
//  > 7623.376623376624
//  > 7680.319680319681
//  > 7756.243756243756
//  > 7868.131868131868
//  > 7864.135864135864
//  > 7747.252747252747
//  > 7878.121878121878
//  > 7892.107892107892
//  > 7750.24975024975
//  > 7893.106893106893
//  > 7971.028971028971
// Average (mean) 7812.853812853813

// fakeBind
// Raw:
//  > 6428.571428571428
//  > 6300.699300699301
//  > 6182.817182817183
//  > 6314.685314685315
//  > 6177.822177822178
//  > 6130.8691308691305
//  > 6240.759240759241
//  > 6039.96003996004
//  > 6287.712287712287
//  > 6247.752247752248
//  > 5707.292707292708
//  > 6107.892107892108
//  > 6322.677322677323
//  > 6215.784215784216
//  > 6333.666333666333
//  > 6216.783216783217
//  > 6156.843156843157
//  > 6206.793206793207
//  > 6210.789210789211
//  > 6214.7852147852145
//  > 6217.782217782218
// Average (mean) 6202.987488701774

// Winner: unbound
// Compared with next highest (realBind), it's:
// 94.6% faster
// 18.52 times as fast
// 1.27 order(s) of magnitude faster

// Compared with the slowest (fakeBind), it's:
// 95.71% faster
// 23.33 times as fast
// 1.37 order(s) of magnitude faster
